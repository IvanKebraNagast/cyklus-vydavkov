<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Sledovanie v√Ωdavkov</title>

<!-- PWA -->
<link rel="manifest" href="/cyklus-vydavkov/manifest.webmanifest">
<meta name="theme-color" content="#ffffff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Sledovanie v√Ωdavkov">
<link rel="apple-touch-icon" href="/cyklus-vydavkov/icon.png">

<!-- Frameworks -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
body { font-family: 'Inter', sans-serif; }

.modal { background-color: rgba(0,0,0,0.5); transition: opacity .3s; }
.modal-content { animation: fadeInScale .3s forwards; }
.sidebar { transition: transform .3s; }

@keyframes fadeInScale {
  from { opacity:0; transform:scale(.95); }
  to   { opacity:1; transform:scale(1); }
}

/* === TLAƒå === */
@media print {
  .no-print { display:none !important; }
  .print-area { display:block !important; position:static; width:100%; height:auto; background:none; }
  body, html { height:auto; overflow:visible; margin:0; padding:0; }
}
.print-header { text-align:center; margin-bottom:2rem; }
.print-header h1 { font-size:2rem; font-weight:bold; color:#1e3a8a; }
.print-header p { color:#4b5563; }
.print-section { margin-bottom:2rem; }
.print-section h2 { font-size:1.5rem; font-weight:bold; color:#1f2937; margin-bottom:1rem; }
.print-table { width:100%; border-collapse:collapse; margin-top:1rem; }
.print-table th, .print-table td { border:1px solid #d1d5db; padding:.75rem; }
</style>
</head>
  <body class="bg-gray-100 flex min-h-screen p-4">

<div id="main-content" class="container mx-auto bg-white shadow-xl rounded-2xl p-8 space-y-8 max-w-4xl">

<header class="text-center">
  <h1 class="text-4xl font-bold text-blue-900 mb-2">Sledovanie v√Ωdavkov</h1>

  <div class="inline-block px-4 py-1.5 bg-gray-200 rounded-full text-gray-700 text-sm font-medium">
    Vytvoril: IvanKebraNagast
  </div>

  <p id="cycle-dates" class="text-gray-600">
    Sledovanie rozpoƒçtu.
  </p>
</header>

<!-- SPR√ÅVA CYKLOV -->
<section class="bg-gray-50 p-6 rounded-xl border border-gray-200 flex flex-col md:flex-row items-center justify-between gap-4 no-print">
  <h2 class="text-xl font-bold text-gray-800">Spr√°va cyklov</h2>
  
  <div class="flex gap-4 w-full md:w-auto">
    <button id="start-new-cycle-btn" class="flex-1 px-6 py-2.5 bg-blue-600 text-white font-bold rounded-lg shadow-md hover:bg-blue-700">
      Ukonƒçi≈• aktu√°lny cyklus a zaƒça≈• nov√Ω
    </button>

    <button id="view-history-btn" class="flex-1 px-6 py-2.5 bg-gray-600 text-white font-bold rounded-lg shadow-md hover:bg-gray-700">
      Zobrazi≈• hist√≥riu
    </button>
  </div>
</section>

<!-- AKTU√ÅLNY CYKLUS -->
<div id="current-cycle-forms">

  <!-- PR√çJEM + SUM√ÅR -->
  <section class="bg-gray-50 p-6 rounded-xl border border-gray-200 grid grid-cols-1 md:grid-cols-3 gap-4 no-print">

    <div class="flex flex-col items-start space-y-2">
      <label for="monthly-income-input" class="text-sm font-medium text-gray-700">Celkov√Ω pr√≠jem (‚Ç¨)</label>
      <input type="number" id="monthly-income-input" placeholder="0.00" step="0.01"
             class="w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500">
      <button id="save-income-btn"
        class="w-full px-6 py-2.5 bg-green-600 text-white font-bold rounded-lg shadow-md hover:bg-green-700">
        Ulo≈æi≈• pr√≠jem
      </button>
    </div>

    <div class="flex flex-col items-center justify-center bg-blue-100 p-4 rounded-lg">
      <span class="text-sm font-medium text-blue-800">Minul som</span>
      <span id="total-spent" class="text-2xl font-bold text-blue-600 mt-1">0.00 ‚Ç¨</span>
    </div>

    <div id="remaining-budget-container" class="flex flex-col items-center justify-center p-4 rounded-lg">
      <span class="text-sm font-medium text-green-800">Zost√°va mi</span>
      <span id="remaining-budget" class="text-2xl font-bold mt-1">0.00 ‚Ç¨</span>
    </div>

  </section>

  <!-- ROZPOƒåET -->
  <section class="bg-gray-50 p-6 rounded-xl border border-gray-200 no-print">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">Rozpoƒçtov√© pravidlo</h2>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">

      <div class="input-group">
        <label for="budget-category-select" class="block text-sm text-gray-700 mb-1">Polo≈æka pre rozpoƒçet</label>

        <select id="budget-category-select"
                class="w-full px-4 py-2 border rounded-lg bg-white focus:ring-blue-500 focus:border-blue-500">
        </select>

        <input type="text" id="budget-custom-category"
               placeholder="Zadaj vlastn√∫ polo≈æku"
               class="w-full px-4 py-2 border rounded-lg mt-2 hidden" />

        <label for="budget-amount-input" class="block text-sm text-gray-700 mb-1 mt-4">Rozpoƒçet (‚Ç¨)</label>
        <input type="number" id="budget-amount-input" placeholder="100.00" step="0.01"
               class="w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500">
      </div>

      <button id="save-budget-btn"
        class="w-full px-6 py-2.5 bg-yellow-600 text-white font-bold rounded-lg shadow-md hover:bg-yellow-700">
        Ulo≈æi≈• rozpoƒçet
      </button>

    </div>

    <div id="budget-bar-chart-container"
         class="relative w-full max-w-2xl mx-auto mt-6 hidden">
      <canvas id="budget-bar-chart"></canvas>
    </div>

    <div id="budget-status-container" class="mt-6 space-y-4"></div>
  </section>

  <!-- PRIDA≈§ V√ùDAVOK -->
  <section class="bg-gray-50 p-6 rounded-xl border border-gray-200 no-print">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">Prida≈• nov√Ω v√Ωdavok</h2>

    <label for="expense-category" class="block text-sm text-gray-700 mb-1">Polo≈æka</label>

    <select id="expense-category"
            class="w-full px-4 py-2 border rounded-lg bg-white focus:ring-blue-500 focus:border-blue-500">
    </select>

    <input type="text" id="expense-custom-category"
           placeholder="Zadaj vlastn√∫ polo≈æku"
           class="w-full px-4 py-2 border rounded-lg mt-2 hidden" />

    <div class="input-group mt-4">
      <label for="expense-amount" class="block text-sm text-gray-700 mb-1">Suma (‚Ç¨)</label>
      <input type="number" id="expense-amount" placeholder="50.00" step="0.01"
             class="w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500">
    </div>

    <button id="add-expense-btn"
      class="w-full mt-4 px-6 py-2.5 bg-blue-600 text-white font-bold rounded-lg shadow-md hover:bg-blue-700">
      Prida≈•
    </button>

  </section>

</div>

<!-- INFO pri historickom re≈æime -->
<div id="history-view-message" class="hidden bg-gray-200 p-6 rounded-xl text-center">
  <p class="text-xl font-bold text-gray-700">Moment√°lne prezer√°te historick√Ω cyklus.</p>
  <p class="text-sm text-gray-600 mt-2">D√°ta s√∫ len na ƒç√≠tanie.</p>
</div>

<!-- GRAF + TABUƒΩKA -->
<section class="flex flex-col lg:flex-row gap-8">

  <!-- GRAF -->
  <div id="pie-chart-section"
       class="flex-1 bg-gray-50 p-6 rounded-xl border border-gray-200 shadow-sm flex flex-col items-center">

    <h2 class="text-2xl font-bold text-gray-800 mb-4">Graf v√Ωdavkov</h2>

    <div class="relative w-full max-w-sm flex flex-col items-center">
      <canvas id="expense-pie-chart"></canvas>
      <div id="chart-legend" class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-700"></div>
      <div id="chart-summary" class="mt-6 text-sm text-gray-800 font-medium w-full"></div>
    </div>

  </div>

  <!-- TABUƒΩKA -->
  <div class="flex-1 bg-gray-50 p-6 rounded-xl border border-gray-200 shadow-sm overflow-x-auto flex flex-col">

    <h2 class="text-2xl font-bold text-gray-800 mb-4">Prehƒæad v√Ωdavkov</h2>

    <div class="table-container">
      <table class="min-w-full table-auto text-center">
        <thead>
          <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
            <th class="py-3 px-6 text-left">D√°tum a polo≈æka</th>
            <th class="py-3 px-6 text-left">Suma (‚Ç¨)</th>
          </tr>
        </thead>
        <tbody id="expense-table-body" class="text-gray-700 text-sm font-light"></tbody>
      </table>
    </div>

    <button id="delete-current-cycle-btn"
      class="mt-4 w-full px-6 py-2.5 bg-red-600 text-white font-bold rounded-lg shadow-md hover:bg-red-700 no-print">
      Vymaza≈• d√°ta aktu√°lneho cyklu
    </button>

  </div>

</section>

<section class="mt-4 flex justify-center no-print">
  <button id="print-all-btn"
    class="flex items-center gap-2 px-6 py-2.5 bg-gray-600 text-white font-bold rounded-lg shadow-md hover:bg-gray-700">
    üñ®Ô∏è Tlaƒçi≈•
  </button>
</section>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// === STAV APLIK√ÅCIE ===
let expenses = [];
let pieChart;
let budgetChart;

let monthlyIncome = 0;
let monthlyBudget = {};
let cycleStartDate = null;

let istoryView = false;
let historicalCycles = [];
let messageTimeout;

// Vlastn√© kateg√≥rie
let customCategories = [];


// === ≈†tandardn√© kateg√≥rie ===
const baseCategories = [
  "N√°jomn√©","Internet","Elektrika","K√∫renie","Poistka za auto",
  "Poistenie zodpovednosti za byt","Potraviny","Doprava",
  "Z√°bava","Cigarety","Alkohol","Ostatn√©"
];


// === ULO≈ΩENIE DO LOCALSTORAGE ===
function saveDataToLocalStorage() {
  const data = {
    expenses,
    monthlyIncome,
    monthlyBudget,
    customCategories,
    cycleStartDate: cycleStartDate ? cycleStartDate.toISOString() : null
  };
  localStorage.setItem("currentCycleData", JSON.stringify(data));
}

function saveHistoricalCycles() {
  localStorage.setItem("historicalCycles", JSON.stringify(historicalCycles));
}


// === NAƒå√çTANIE Z LOCALSTORAGE ===
function loadDataFromLocalStorage() {
  const saved = localStorage.getItem("currentCycleData");
  if (saved) {
    const data = JSON.parse(saved);
    expenses = data.expenses || [];
    monthlyIncome = data.monthlyIncome || 0;
    monthlyBudget = data.monthlyBudget || {};
    customCategories = Array.isArray(data.customCategories) ? data.customCategories : [];
    cycleStartDate = data.cycleStartDate ? new Date(data.cycleStartDate) : null;
  }

  const hist = localStorage.getItem("historicalCycles");
  if (hist) historicalCycles = JSON.parse(hist);
}


// === RENDER SELECTOV (v√Ωdavky + rozpoƒçet) ===
function renderCategorySelectors() {
  const cat = document.getElementById("expense-category");
  const bcat = document.getElementById("budget-category-select");

  cat.innerHTML = "";
  bcat.innerHTML = "";

  // ≈°tandardn√© kateg√≥rie
  baseCategories.forEach(c => {
    cat.innerHTML += `<option value="${c}">${c}</option>`;
    bcat.innerHTML += `<option value="${c}">${c}</option>`;
  });

  // vlastn√© kateg√≥rie
  customCategories.forEach(c => {
    cat.innerHTML += `<option value="${c}">${c}</option>`;
    bcat.innerHTML += `<option value="${c}">${c}</option>`;
  });

  // mo≈ænos≈• prida≈• vlastn√∫
  cat.innerHTML += `<option value="custom">‚ûï Vlastn√° polo≈æka</option>`;
  bcat.innerHTML += `<option value="custom">‚ûï Vlastn√° polo≈æka</option>`;
}


// === INPUTY pre vlastn√© polo≈æky ===
function setupCustomInputs() {
  document.getElementById("expense-category").addEventListener("change", () => {
    const val = document.getElementById("expense-category").value;
    document.getElementById("expense-custom-category").classList.toggle("hidden", val !== "custom");
  });

  document.getElementById("budget-category-select").addEventListener("change", () => {
    const val = document.getElementById("budget-category-select").value;
    document.getElementById("budget-custom-category").classList.toggle("hidden", val !== "custom");
  });
}


// === SPR√ÅVY ===
function showMessage(msg, type="success") {
  const box = document.getElementById("message-box");
  const text = document.getElementById("message-text");

  clearTimeout(messageTimeout);

  text.textContent = msg;
  box.classList.remove("hidden","bg-green-500","bg-red-500","bg-blue-500");

  box.classList.add(
    type==="success" ? "bg-green-500" :
    type==="error"   ? "bg-red-500"   :
                       "bg-blue-500"
  );

  messageTimeout = setTimeout(() => box.classList.add("hidden"), 3000);
}


// === D√ÅTUMY ===
function updateCycleDatesDisplay(start=cycleStartDate, end=null) {
  const el = document.getElementById("cycle-dates");
  const s = start ? start.toLocaleDateString("sk-SK") : "N/A";
  const e = end   ? end.toLocaleDateString("sk-SK") : "N/A";

  if (istoryView) el.textContent = `Cyklus od ${s} do ${e}.`;
  else if (start) el.textContent = `Sledovanie rozpoƒçtu od ${s}.`;
  else el.textContent = `Zaƒçnite prid√°van√≠m v√Ωdavkov alebo pr√≠jmov.`;
}


// === RENDER UI ===
function renderAllUI() {
  updateChart();
  updateBudgetStatus();
  updateBudgetRuleChart();
  renderTable();
  updateCycleDatesDisplay();

  document.getElementById("monthly-income-input").value = monthlyIncome;
}


// === HIST√ìRIA ‚Äì zoznam cyklov ===
function renderHistorySidebar() {
  const list = document.getElementById("history-list");
  list.innerHTML = "";

  if (historicalCycles.length === 0) {
    list.innerHTML = `<p class="text-gray-400">Zatiaƒæ ≈æiadna hist√≥ria cyklov.</p>`;
    return;
  }

  const sorted = [...historicalCycles].sort((a,b) => b.id - a.id);

  sorted.forEach(cycle => {
    const start = new Date(cycle.cycleStartDate).toLocaleDateString("sk-SK");
    const end   = new Date(cycle.cycleEndDate).toLocaleDateString("sk-SK");

    const div = document.createElement("div");
    div.className = "bg-gray-800 p-4 rounded-lg flex justify-between items-center";

    div.innerHTML = `
      <div class="cursor-pointer hover:text-gray-400 flex-grow"
           onclick="loadArchivedCycle(${cycle.id})">
        <h4 class="font-bold text-lg">Cyklus: ${start} ‚Äì ${end}</h4>
        <p class="text-sm text-gray-400">Pr√≠jem: ${cycle.monthlyIncome.toFixed(2)} ‚Ç¨</p>
      </div>
      <button class="text-gray-500 hover:text-red-500 ml-4"
              onclick="deleteSingleCycle(${cycle.id}, '${start}‚Äì${end}')">
        <i class="fas fa-trash-alt"></i>
      </button>
    `;

    list.appendChild(div);
  });
}


// === DELETE jedn√©ho cyklu ===
function deleteSingleCycle(id, label) {
  if (!confirm(`Vymaza≈• cyklus ${label}?`)) return;

  historicalCycles = historicalCycles.filter(c => c.id !== id);
  saveHistoricalCycles();
  renderHistorySidebar();
  showMessage("Cyklus vymazan√Ω.","success");
}


// === Sp√§≈• na aktu√°lny cyklus ===
function backToCurrentCycle() {
  istoryView = false;
  loadDataFromLocalStorage();
  renderAllUI();
  document.getElementById("history-sidebar").classList.add("translate-x-full");
}


// === Nov√Ω cyklus ===
function startNewCycle() {
  if (!confirm("Ukonƒçi≈• cyklus a zaƒça≈• nov√Ω? D√°ta sa ulo≈æia do hist√≥rie.")) return;

  const endDate = new Date();

  const archive = {
    id: endDate.getTime(),
    expenses,
    monthlyIncome,
    monthlyBudget,
    customCategories,
    cycleStartDate: cycleStartDate ? cycleStartDate.toISOString() : null,
    cycleEndDate: endDate.toISOString()
  };

  historicalCycles.push(archive);
  saveHistoricalCycles();

  // reset
  expenses = [];
  monthlyIncome = 0;
  monthlyBudget = {};
  customCategories = [];
  cycleStartDate = null;

  saveDataToLocalStorage();
  renderAllUI();

  showMessage("Nov√Ω cyklus spusten√Ω!","success");
}


// === Naƒç√≠tanie historick√©ho cyklu ===
function loadArchivedCycle(id) {
  const data = historicalCycles.find(c => c.id === id);
  if (!data) return showMessage("Chyba pri naƒç√≠tan√≠ hist√≥rie","error");

  istoryView = true;

  expenses = data.expenses || [];
  monthlyIncome = data.monthlyIncome || 0;
  monthlyBudget = data.monthlyBudget || {};
  customCategories = data.customCategories || [];
  cycleStartDate = new Date(data.cycleStartDate);

  renderCategorySelectors();
  setupCustomInputs();
  renderAllUI();

  document.getElementById("history-sidebar").classList.add("translate-x-full");
  showMessage("Prezer√°≈° historick√Ω cyklus","info");
}
</script>
<script>
// === TABUƒΩKA V√ùDAVKOV ===
function renderTable() {
  const body = document.getElementById("expense-table-body");
  body.innerHTML = "";

  if (expenses.length === 0) {
    body.innerHTML = `
      <tr>
        <td colspan="2" class="py-3 px-6 text-center text-gray-500">
          Zatiaƒæ ≈æiadne d√°ta pre tento cyklus.
        </td>
      </tr>`;
    return;
  }

  const sorted = [...expenses].sort((a, b) => new Date(b.date) - new Date(a.date));

  sorted.forEach(e => {
    const tr = document.createElement("tr");
    tr.className = "border-b border-gray-200 hover:bg-gray-100";

    tr.innerHTML = `
      <td class="py-3 px-6 text-left">
        ${new Date(e.date).toLocaleDateString("sk-SK")} ‚Äì ${e.category}
      </td>
      <td class="py-3 px-6 text-left text-red-600">-${e.amount.toFixed(2)} ‚Ç¨</td>
    `;

    body.appendChild(tr);
  });
}



// === BUDGET SUMMARY ===
function updateBudgetStatus() {
  const total = expenses.reduce((s, e) => s + e.amount, 0);
  const remaining = monthlyIncome - total;

  document.getElementById("total-spent").textContent = `${total.toFixed(2)} ‚Ç¨`;

  const el = document.getElementById("remaining-budget");
  const box = document.getElementById("remaining-budget-container");

  el.textContent = `${remaining.toFixed(2)} ‚Ç¨`;

  box.className = "flex flex-col items-center justify-center p-4 rounded-lg";

  if (remaining < 0) {
    box.classList.add("bg-red-100");
    el.classList.add("text-red-600");
  } else if (remaining < monthlyIncome * 0.1) {
    box.classList.add("bg-yellow-100");
    el.classList.add("text-yellow-600");
  } else {
    box.classList.add("bg-green-100");
    el.classList.add("text-green-600");
  }
}



// === PIE CHART ===
function updateChart() {
  if (!document.getElementById("expense-pie-chart")) return;

  const totals = expenses.reduce((acc, e) => {
    acc[e.category] = (acc[e.category] || 0) + e.amount;
    return acc;
  }, {});

  const labels = Object.keys(totals);
  const data = Object.values(totals);

  if (pieChart) pieChart.destroy();

  const ctx = document.getElementById("expense-pie-chart").getContext("2d");

  pieChart = new Chart(ctx, {
    type: "pie",
    data: {
      labels,
      datasets: [{
        data,
        backgroundColor: [
          "#EF4444","#3B82F6","#F59E0B","#10B981","#6366F1",
          "#EC4899","#34D399","#F97316","#A78BFA","#D946EF",
          "#4B5563","#9CA3AF"
        ],
        borderColor: "#fff",
        borderWidth: 2
      }]
    },
    options: { responsive: true, plugins: { legend: { display: false } } }
  });

  const summary = document.getElementById("chart-summary");
  summary.innerHTML = "";

  labels.forEach((l, i) => {
    summary.innerHTML += `
      <div class="flex justify-between border-b border-gray-200 py-1">
        <span>${l}</span>
        <span class="font-semibold">${data[i].toFixed(2)} ‚Ç¨</span>
      </div>
    `;
  });
}



// === BAR GRAF ROZPOƒåTU ===
function updateBudgetRuleChart() {
  const cont = document.getElementById("budget-bar-chart-container");
  const labels = Object.keys(monthlyBudget);

  if (labels.length === 0) {
    cont.classList.add("hidden");
    if (budgetChart) budgetChart.destroy();
    return;
  }

  cont.classList.remove("hidden");

  if (budgetChart) budgetChart.destroy();

  const ctx = document.getElementById("budget-bar-chart").getContext("2d");

  const budgetVals = labels.map(c => monthlyBudget[c]);
  const spentVals = labels.map(c =>
    expenses.filter(e => e.category === c).reduce((s, e) => s + e.amount, 0)
  );

  budgetChart = new Chart(ctx, {
    type: "bar",
    data: {
      labels,
      datasets: [
        { label: "Rozpoƒçet", data: budgetVals, backgroundColor: "rgba(75,192,192,0.5)" },
        { label: "Minut√©", data: spentVals, backgroundColor: "rgba(255,99,132,0.5)" }
      ]
    },
    options: { responsive: true, scales: { y: { beginAtZero: true } } }
  });
}



// === PRID√ÅVANIE V√ùDAVKU ===
function handleAddExpense() {
  if (istoryView) return showMessage("V hist√≥rii nem√¥≈æe≈° prid√°va≈• v√Ωdavky.", "error");

  let category = document.getElementById("expense-category").value;

  if (category === "custom") {
    category = document.getElementById("expense-custom-category").value.trim();
    if (!category) return showMessage("Zadaj vlastn√∫ polo≈æku.", "error");

    customCategories.push(category);
    saveDataToLocalStorage();
    renderCategorySelectors();
  }

  const amount = parseFloat(document.getElementById("expense-amount").value);
  if (isNaN(amount) || amount <= 0) return showMessage("Zadaj platn√∫ sumu.", "error");

  if (!cycleStartDate) cycleStartDate = new Date();

  expenses.push({ date: new Date().toISOString(), category, amount });

  saveDataToLocalStorage();
  renderAllUI();

  document.getElementById("expense-amount").value = "";
  showMessage("V√Ωdavok pridan√Ω!", "success");
}



// === ROZPOƒåET ===
function handleSaveBudget() {
  if (istoryView) return showMessage("V hist√≥rii nem√¥≈æe≈° uklada≈• rozpoƒçet.", "error");

  let category = document.getElementById("budget-category-select").value;

  if (category === "custom") {
    category = document.getElementById("budget-custom-category").value.trim();
    if (!category) return showMessage("Zadaj vlastn√∫ polo≈æku.", "error");

    customCategories.push(category);
    renderCategorySelectors();
  }

  const amount = parseFloat(document.getElementById("budget-amount-input").value);
  if (isNaN(amount) || amount < 0) return showMessage("Zadaj platn√Ω rozpoƒçet.", "error");

  monthlyBudget[category] = amount;

  saveDataToLocalStorage();
  renderAllUI();
  showMessage("Rozpoƒçet ulo≈æen√Ω!", "success");
}



// === PR√çJEM ===
function handleSaveIncome() {
  if (istoryView) return showMessage("V hist√≥rii nem√¥≈æe≈° uklada≈• pr√≠jem.", "error");

  const income = parseFloat(document.getElementById("monthly-income-input").value);
  if (isNaN(income) || income < 0) return showMessage("Zadaj platn√Ω pr√≠jem.", "error");

  monthlyIncome = income;
  if (!cycleStartDate) cycleStartDate = new Date();

  saveDataToLocalStorage();
  renderAllUI();
  showMessage("Pr√≠jem ulo≈æen√Ω!", "success");
}



// === VYMAZANIE AKTU√ÅLNEHO CYKLU ===
function handleDeleteCurrentCycle() {
  if (istoryView) return showMessage("Nem√¥≈æe≈° maza≈• historick√© cykly.", "error");

  if (!confirm("Naozaj chce≈° VYMAZA≈§ cel√Ω aktu√°lny cyklus?")) return;

  expenses = [];
  monthlyIncome = 0;
  monthlyBudget = {};
  customCategories = [];
  cycleStartDate = null;

  saveDataToLocalStorage();
  renderAllUI();

  showMessage("Aktu√°lny cyklus bol vymazan√Ω.", "success");
}



// === TLAƒå ===
function handlePrint() {
  window.print();
}



// === DOMContentLoaded ===
document.addEventListener("DOMContentLoaded", () => {
  loadDataFromLocalStorage();

  renderCategorySelectors();
  setupCustomInputs();
  renderAllUI();

  document.getElementById("add-expense-btn").addEventListener("click", handleAddExpense);
  document.getElementById("save-income-btn").addEventListener("click", handleSaveIncome);
  document.getElementById("save-budget-btn").addEventListener("click", handleSaveBudget);
  document.getElementById("delete-current-cycle-btn").addEventListener("click", handleDeleteCurrentCycle);

  document.getElementById("start-new-cycle-btn").addEventListener("click", startNewCycle);

  document.getElementById("view-history-btn").addEventListener("click", () => {
    renderHistorySidebar();
    document.getElementById("history-sidebar").classList.remove("translate-x-full");
  });

  document.getElementById("print-all-btn").addEventListener("click", handlePrint);
});



// === SERVICE WORKER ===
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/cyklus-vydavkov/sw.js");
  });
}
</script>
<!-- MESSAGE BOX ‚Äì pre showMessage() -->
<div id="message-box" class="hidden fixed bottom-6 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-xl text-white font-bold shadow-lg z-50">
  <span id="message-text"></span>
</div>


<!-- SIDEBAR HIST√ìRIE -->
<div id="history-sidebar"
     class="fixed top-0 right-0 w-80 h-full bg-gray-900 text-white shadow-2xl transform translate-x-full transition-all duration-300 z-50 flex flex-col">

  <div class="p-4 border-b border-gray-700 flex justify-between items-center">
    <h3 class="text-xl font-bold">Hist√≥ria cyklov</h3>
    <button id="close-history-btn" class="text-gray-400 hover:text-white text-2xl">&times;</button>
  </div>

  <div id="history-list" class="flex-1 overflow-y-auto p-4 space-y-4"></div>

  <button id="back-to-current-btn"
          class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3">
    ‚Üê Sp√§≈• na aktu√°lny cyklus
  </button>

  <button id="delete-history-btn"
          class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 mt-2">
    Vymaza≈• cel√∫ hist√≥riu
  </button>
</div>


</div> <!-- main-content END -->

</body>
</html>

